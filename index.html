<!doctype html>
<html>
    <head>
        <meta charset="UTF-8" />
        <title></title>
		
        <script src="jquery-3.3.1.min.js"></script>
		
		<style>
			
		</style>
		
		
    </head>
    <body>

     <canvas id="myCanvas" width="1000" height="600" style="border:1px solid #000000;">
	</canvas>

    </body>
	<script>
			var scanData;
			var c = document.getElementById("myCanvas");
			var ctx = c.getContext("2d");
			var items = [];
			var locations = [];
		
			$.ajax({
				method: "GET",
				url: "scans.json",
				dataType: "text"
			}).done(function (data) {
				scanData = JSON.parse(data);
				
				var maxX = -10000.0, minX = 10000.0, maxY = -10000.0, minY = 10000.0, maxZ = -10000.0, minZ = 10000.0;
				var minTime = 15393024303810, maxTime = 0;
				
				
				for (i = 0; i < scanData.length; i++) {
				
					//MinMax calculations
					if (scanData[i].location[0] > maxX) {
						maxX = scanData[i].location[0];
					}
					if (scanData[i].location[0] < minX) {
						minX = scanData[i].location[0];
					}
					
					if (scanData[i].location[1] > maxY) {
						maxY = scanData[i].location[1];
					}
					if (scanData[i].location[1] < minY) {
						minY = scanData[i].location[1];
					}
					
					if (scanData[i].location[2] > maxZ) {
						maxZ = scanData[i].location[2];
					}
					if (scanData[i].location[2] < minZ) {
						minZ = scanData[i].location[2];
					}
					
					if (scanData[i].timestamp > maxTime) {
						maxTime = scanData[i].timestamp;
					}
					if (scanData[i].timestamp < minTime) {
						minTime = scanData[i].timestamp;
					}
					
					//Location build
					var locationCount = 0;
					while (locationCount < locations.length && !(locations[locationCount].x == scanData[i].location[0] &&
																 locations[locationCount].y == scanData[i].location[1] &&
																 locations[locationCount].z == scanData[i].location[2])) {
						locationCount++;
					}
					
					if (locationCount == locations.length) {
						locations.push({
							x:scanData[i].location[0],
							y:scanData[i].location[1],
							z:scanData[i].location[2]
						});
					}
					
					
					ctx.beginPath();
					ctx.arc(scanData[i].location[0] * 22 - 200, scanData[i].location[1] * 20 - (scanData[i].location[2] * 10), (-scanData[i].location[2] / 2) + 5, 0, 2 * Math.PI);
					ctx.stroke();
					
					if (items[scanData[i].id] != undefined) {
						
						ctx.moveTo(items[scanData[i].id].location[0] * 22 - 200, items[scanData[i].id].location[1] * 20 - (items[scanData[i].id].location[2] * 10));
						ctx.lineTo(scanData[i].location[0] * 22 - 200, scanData[i].location[1] * 20 - (scanData[i].location[2] * 10));
						//ctx.strokeStyle = "green";
						ctx.stroke();
						
						/*ctx.moveTo(items[scanData[i].id].location[0] * 22 - 200, items[scanData[i].id].location[1] * 20);
						ctx.lineTo(items[scanData[i].id].location[0] * 22 - 200, scanData[i].location[1] * 20);
						//ctx.strokeStyle = "red";
						ctx.stroke();
						
						ctx.moveTo(items[scanData[i].id].location[0] * 22 - 200, scanData[i].location[1] * 20);
						ctx.lineTo(scanData[i].location[0] * 22 - 200, scanData[i].location[1] * 20);
						//ctx.strokeStyle = "red";
						ctx.stroke();*/
						
					}
					
					items[scanData[i].id] = scanData[i];
				};
				
				locations.sort(function (a,b) {
					if (a.x != b.x) {
						return b.x - a.x;
					} else if (a.y != b.y) {
						return b.y - a.y;
					} else {
						return b.z - a.z;
					}
				});
				
				console.log("MaxX:" + maxX);
				console.log("MinX:" + minX);
				console.log("MaxY:" + maxY);
				console.log("MinY:" + minY);
				console.log("MaxZ:" + maxZ);
				console.log("MinZ:" + minZ);
				console.log("MaxTime:" + maxTime);
				console.log("MinTime:" + minTime);
				console.log("Timediff:" + (maxTime - minTime));
				
			});
			
			function drawType(x, y, z, type) {
				// The size of the emoji is set with the font
				ctx.font = '20px serif'
				ctx.textAlign = "center"; 
				ctx.textBaseline = "middle"; 
				
				var emojistring = "";
				
				switch (type) {
					case "example": emojistring = "hehe"; break;
					case "bread": emojistring = "🍞"; break;
				}
				
				ctx.fillText(emojistring, x, y);
			}
			
		</script>
	
</html>